// SAGAR LADLA
// EMBEDDED SYSTEM DESIGN
// ASSIGNMENT 1
// QUESTION 3 CODE
	AREA RESET, CODE, READONLY
	EXPORT __Vectors
__Vectors
	DCD 0X20001000, Reset_Handler + 1, 0,0,0,0,0,0,0,0,0, SVC_Handler + 1, 0,0,0,0,0,0,0,0,0,0,0
	AREA mycode, CODE, READONLY
	ENTRY
	EXPORT Reset_Handler
Reset_Handler
	; SWITCH TO UNPRIVILEGED MODE FOR USER PROGRAM
	LDR R1, =0x20000200
	MSR PSP, R1
	MOV R0, #0x03
	MSR CONTROL, R0
	; INITIALIZATIONS AND MAIN PROGRAM
	LDR R7, =SRC
	LDR R1, [R7], #0x04 ; LOAD 123 IN R1
	LDR R2, [R7] ; LOAD 01123
	LDR R8, =DST ; INITIALIZE POINTER TO DST ADDRESS
	SVC 123 ; SVC INTERRUPT
	LDR R3, [R8] ;  LOAD THE VALUE FROM MEMORY BACK TO R3 (RESTORE CALCULATIONS IN UNPRIVILEGED MODE WHICH WERE CALCULATED IN PRIVILEGED MODE)
STOP
	B STOP
SVC_Handler
	; INSTRUCTIONS TO READ THE SVC ARGUMENT
	TST LR, #0x04
	ITE EQ
	MRSEQ R0, MSP
	MRSNE R0, PSP
	LDR R0, [R0, #24]
	LDRB R0, [R0, #-2]
	; ACTUAL ISR PROGRAM
	CMP R0, R2 ; COMPARE SVC CODE WITH 01123 (SECOND PARAMETER - 01123 WHICH IS NOT EQUAL TO SVC CODE HENCE SUBTRACTION)
	ADDEQ R3, R1, R2
	SUBNE R3, R1, R2
	STR R3, [R8] ; STORE THE CONTENTS OF R3 TO THE MEMORY AS AFTER RETURNING FROM SUPERVISOR MODE R0 AND R3 WILL BE RESTORED BACK TO IT'S ORIGINAL VALUE
	BX LR ; RETURN TO Reset_Handler
SRC
	DCD 123, 01123 ; TWO ARGUMENTS
	
	AREA RES, DATA, READWRITE
DST
	DCD 0x00 ; MEMORY ADDRESS FOR STORING THE RESULT
	END
